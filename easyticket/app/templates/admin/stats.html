<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng k√™ h·ªá th·ªëng - EasyTicket Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        .stats-card:hover {
            transform: translateY(-2px);
        }
        .card-icon {
            font-size: 2rem;
            opacity: 0.7;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="mb-4">üìä Th·ªëng k√™ h·ªá th·ªëng EasyTicket</h1>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">T·ªïng ng∆∞·ªùi d√πng</h6>
                                <h2>{{ total_users }}</h2>
                                <small>+{{ new_users }} m·ªõi (7 ng√†y)</small>
                            </div>
                            <i class="fas fa-users card-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">T·ªïng s·ª± ki·ªán</h6>
                                <h2>{{ total_events }}</h2>
                                <small>+{{ new_events }} m·ªõi (7 ng√†y)</small>
                            </div>
                            <i class="fas fa-calendar-alt card-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">T·ªïng ƒë∆°n h√†ng</h6>
                                <h2>{{ total_orders }}</h2>
                                <small>+{{ new_orders }} m·ªõi (7 ng√†y)</small>
                            </div>
                            <i class="fas fa-shopping-cart card-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-warning text-dark">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">T·ªïng doanh thu</h6>
                                <h2>{{ "{:,.0f}".format(total_revenue) }} ‚Ç´</h2>
                                <small>{{ "{:,.0f}".format(recent_revenue) }} ‚Ç´ (7 ng√†y)</small>
                            </div>
                            <i class="fas fa-money-bill-wave card-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">

            <!-- TH·ªêNG K√ä THEO TH·ªúI GIAN -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>üìà Th·ªëng k√™ theo th·ªùi gian</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="timeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="monthly-tab" data-bs-toggle="tab" data-bs-target="#monthly" type="button" role="tab">Theo th√°ng</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="quarterly-tab" data-bs-toggle="tab" data-bs-target="#quarterly" type="button" role="tab">Theo qu√Ω</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="yearly-tab" data-bs-toggle="tab" data-bs-target="#yearly" type="button" role="tab">Theo nƒÉm</button>
                            </li>
                        </ul>

                        <div class="tab-content" id="timeTabsContent">
                            <!-- Theo th√°ng -->
                            <div class="tab-pane fade show active" id="monthly" role="tabpanel">
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="monthlyEventsChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="monthlyRevenueChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Theo qu√Ω -->
                            <div class="tab-pane fade" id="quarterly" role="tabpanel">
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="quarterlyEventsChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="quarterlyRevenueChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Theo nƒÉm -->
                            <div class="tab-pane fade" id="yearly" role="tabpanel">
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="yearlyEventsChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="yearlyRevenueChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            <!-- Event Status Chart -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä Ph√¢n b·ªë tr·∫°ng th√°i s·ª± ki·ªán</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="eventStatusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Role Chart -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üë• Ph√¢n b·ªë vai tr√≤ ng∆∞·ªùi d√πng</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="userRoleChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Charts -->
        <div class="row mb-4">
            <!-- Top Events Chart -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üèÜ Top s·ª± ki·ªán b√°n ch·∫°y nh·∫•t</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="topEventsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Revenue Trend Chart -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üíµ Xu h∆∞·ªõng doanh thu</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="revenueTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>


        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // D·ªØ li·ªáu t·ª´ Flask
        const eventStatusData = {
            labels: [{% for status, count in event_status_stats %}'{{ status.value }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            counts: [{% for status, count in event_status_stats %}{{ count }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        const userRoleData = {
            labels: [{% for role, count in user_role_stats %}'{{ role.value }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            counts: [{% for role, count in user_role_stats %}{{ count }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        const topEventsData = {
            labels: [{% for event, tickets_sold in top_events %}'{{ event|truncate(20) }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            ticketsSold: [{% for event, tickets_sold in top_events %}{{ tickets_sold }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        const monthlyData = {
            labels: [{% for label in monthly_labels %}'{{ label }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            events: [{% for count in monthly_events %}{{ count }}{% if not loop.last %}, {% endif %}{% endfor %}],
            revenues: [{% for revenue in monthly_revenues %}{{ revenue }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        const quarterlyData = {
            labels: [{% for label in quarterly_labels %}'{{ label }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            events: [{% for count in quarterly_events %}{{ count }}{% if not loop.last %}, {% endif %}{% endfor %}],
            revenues: [{% for revenue in quarterly_revenues %}{{ revenue }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        const yearlyData = {
            labels: [{% for label in yearly_labels %}'{{ label }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            events: [{% for count in yearly_events %}{{ count }}{% if not loop.last %}, {% endif %}{% endfor %}],
            revenues: [{% for revenue in yearly_revenues %}{{ revenue }}{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        // M√†u s·∫Øc cho charts
        const colors = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FFCD56'
        ];

        // 1. Bi·ªÉu ƒë·ªì tr·∫°ng th√°i s·ª± ki·ªán (Pie Chart)
        new Chart(document.getElementById('eventStatusChart'), {
            type: 'pie',
            data: {
                labels: eventStatusData.labels,
                datasets: [{
                    data: eventStatusData.counts,
                    backgroundColor: colors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });

        // 2. Bi·ªÉu ƒë·ªì vai tr√≤ ng∆∞·ªùi d√πng (Doughnut Chart)
        new Chart(document.getElementById('userRoleChart'), {
            type: 'doughnut',
            data: {
                labels: userRoleData.labels,
                datasets: [{
                    data: userRoleData.counts,
                    backgroundColor: colors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });

        // 3. Bi·ªÉu ƒë·ªì top s·ª± ki·ªán (Bar Chart)
        new Chart(document.getElementById('topEventsChart'), {
            type: 'bar',
            data: {
                labels: topEventsData.labels,
                datasets: [{
                    label: 'S·ªë v√© b√°n',
                    data: topEventsData.ticketsSold,
                    backgroundColor: '#36A2EB',
                    borderColor: '#36A2EB',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'S·ªë v√©'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'S·ª± ki·ªán'
                        }
                    }
                }
            }
        });

        // 4. Bi·ªÉu ƒë·ªì xu h∆∞·ªõng doanh thu (Line Chart)
        const revenueTrendData = {
    labels: [{% for label in monthly_labels %}'{{ label }}'{% if not loop.last %}, {% endif %}{% endfor %}],
    revenues: [{% for revenue in monthly_revenues %}{{ revenue }}{% if not loop.last %}, {% endif %}{% endfor %}]
};

        new Chart(document.getElementById('revenueTrendChart'), {
            type: 'line',
            data: {
                labels: revenueTrendData.labels,
                datasets: [{
                    label: 'Doanh thu (VND)',
                    data: revenueTrendData.revenues,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Doanh thu (VND)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString('vi-VN') + ' ‚Ç´';
                            }
                        }
                    }
                }
            }
        });

        // Bi·ªÉu ƒë·ªì theo th√°ng
        new Chart(document.getElementById('monthlyEventsChart'), {
            type: 'bar',
            data: {
                labels: monthlyData.labels,
                datasets: [{
                    label: 'S·ªë s·ª± ki·ªán',
                    data: monthlyData.events,
                    backgroundColor: '#36A2EB',
                    borderColor: '#36A2EB',
                    borderWidth: 1
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('monthlyRevenueChart'), {
            type: 'line',
            data: {
                labels: monthlyData.labels,
                datasets: [{
                    label: 'Doanh thu (VND)',
                    data: monthlyData.revenues,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString('vi-VN') + ' ‚Ç´';
                            }
                        }
                    }
                }
            }
        });

        // Bi·ªÉu ƒë·ªì theo qu√Ω (t∆∞∆°ng t·ª± cho yearly)
        new Chart(document.getElementById('quarterlyEventsChart'), {
            type: 'bar',
            data: {
                labels: quarterlyData.labels,
                datasets: [{
                    label: 'S·ªë s·ª± ki·ªán',
                    data: quarterlyData.events,
                    backgroundColor: '#FF6384',
                    borderColor: '#FF6384',
                    borderWidth: 1
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('quarterlyRevenueChart'), {
            type: 'line',
            data: {
                labels: quarterlyData.labels,
                datasets: [{
                    label: 'Doanh thu (VND)',
                    data: quarterlyData.revenues,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString('vi-VN') + ' ‚Ç´';
                            }
                        }
                    }
                }
            }
        });

        // Bi·ªÉu ƒë·ªì theo nƒÉm
        new Chart(document.getElementById('yearlyEventsChart'), {
            type: 'bar',
            data: {
                labels: yearlyData.labels,
                datasets: [{
                    label: 'S·ªë s·ª± ki·ªán',
                    data: yearlyData.events,
                    backgroundColor: '#FFCE56',
                    borderColor: '#FFCE56',
                    borderWidth: 1
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('yearlyRevenueChart'), {
            type: 'line',
            data: {
                labels: yearlyData.labels,
                datasets: [{
                    label: 'Doanh thu (VND)',
                    data: yearlyData.revenues,
                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString('vi-VN') + ' ‚Ç´';
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>