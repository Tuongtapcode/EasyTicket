{% extends "layout/base.html" %}
{% block content %}
<section class="py-4">
  <div class="container">
    <h3 class="mb-3">Thanh toán</h3>

    <div class="card">
      <div class="card-body">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Loại vé</th>
              <th class="text-center">SL</th>
              <th class="text-end">Đơn giá</th>
              <th class="text-end">Thành tiền</th>
            </tr>
          </thead>
          <tbody>
          {% set subtotal = 0 %}
          {% for od in order.order_details %}
            {% set line = od.price * od.quantity %}
            {% set subtotal = subtotal + line %}
            <tr>
              <td>{{ od.ticket_type.name }}</td>
              <td class="text-center">{{ od.quantity }}</td>
              <td class="text-end">{{ "{:,.0f}".format(od.price) }} VNĐ</td>
              <td class="text-end">{{ "{:,.0f}".format(line) }} VNĐ</td>
            </tr>
          {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <th colspan="3" class="text-end">Tạm tính</th>
              <th class="text-end">{{ "{:,.0f}".format(subtotal) }} VNĐ</th>
            </tr>
            <tr>
              <th colspan="3" class="text-end">Phụ phí</th>
              <th class="text-end">{{ "{:,.0f}".format(order.extra_fee) }} VNĐ</th>
            </tr>
            <tr>
              <th colspan="3" class="text-end">Giảm giá</th>
              <th class="text-end">-{{ "{:,.0f}".format(order.discount) }} VNĐ</th>
            </tr>
            <tr class="table-light">
              <th colspan="3" class="text-end">Tổng thanh toán</th>
              <th class="text-end h5 mb-0">{{ "{:,.0f}".format(order.total_amount) }} VNĐ</th>
            </tr>
          </tfoot>
        </table>

        <form method="post" action="{{ url_for('order.pay', order_id=order.id) }}">
          <div class="d-flex justify-content-end gap-2">
            <a href="{{ url_for('event.event_details', event_id=order.order_details[0].ticket_type.event_id) }}"
               class="btn btn-outline-secondary">Quay lại</a>
            <button class="btn btn-success" type="submit">
              <i class="fas fa-credit-card me-2"></i>Thanh toán
            </button>
          </div>
        </form>
      </div>
    </div>

  </div>
</section>
{% endblock %}