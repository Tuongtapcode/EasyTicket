{% extends 'layout/base.html' %}
{% block content %}
  <!-- Header -->


    <!-- Search Section -->
    <section class="bg-white shadow-sm py-8">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">T√¨m ki·∫øm s·ª± ki·ªán y√™u th√≠ch</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="T√¨m ki·∫øm theo t√™n s·ª± ki·ªán..."
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                    <select id="statusFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="PUBLISHED">ƒê√£ xu·∫•t b·∫£n</option>
                        <option value="DRAFT">B·∫£n nh√°p</option>
                        <option value="CANCELLED">ƒê√£ h·ªßy</option>
                    </select>
                    <button
                        onclick="searchEvents()"
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium"
                    >
                        üîç T√¨m ki·∫øm
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Events Grid -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <div id="eventsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Events will be populated here -->
            </div>

            <div id="noResults" class="text-center py-12 hidden">
                <div class="text-gray-500 text-lg">
                    <p>üòî Kh√¥ng t√¨m th·∫•y s·ª± ki·ªán n√†o ph√π h·ª£p</p>
                    <p class="text-sm mt-2">H√£y th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Event Detail Modal -->
    <div id="eventModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="modalTitle" class="text-2xl font-bold text-gray-800"></h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>

                <div id="modalBanner" class="w-full h-48 bg-gradient-to-r from-purple-400 to-pink-400 rounded-lg mb-4 flex items-center justify-center text-white text-6xl">
                    üé™
                </div>

                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">üìù M√¥ t·∫£</h4>
                        <p id="modalDescription" class="text-gray-600"></p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">üìÖ Th·ªùi gian b·∫Øt ƒë·∫ßu</h4>
                            <p id="modalStartTime" class="text-gray-600"></p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">‚è∞ Th·ªùi gian k·∫øt th√∫c</h4>
                            <p id="modalEndTime" class="text-gray-600"></p>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">üìç ƒê·ªãa ƒëi·ªÉm</h4>
                        <p id="modalAddress" class="text-gray-600"></p>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">üé´ Lo·∫°i v√© c√≥ s·∫µn</h4>
                        <div id="ticketTypes" class="space-y-2">
                            <!-- Ticket types will be populated here -->
                        </div>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button
                            onclick="buyTicket()"
                            class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium"
                        >
                            üéüÔ∏è Mua v√© ngay
                        </button>
                        <button
                            onclick="shareEvent()"
                            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                        >
                            üì§ Chia s·∫ª
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase Success Modal -->
    <div id="purchaseModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 text-center">
            <div class="text-6xl mb-4">üéâ</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Mua v√© th√†nh c√¥ng!</h3>
            <p class="text-gray-600 mb-6">C·∫£m ∆°n b·∫°n ƒë√£ mua v√©. Th√¥ng tin v√© ƒë√£ ƒë∆∞·ª£c g·ª≠i v·ªÅ email c·ªßa b·∫°n.</p>
            <button
                onclick="closePurchaseModal()"
                class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium"
            >
                ƒê√≥ng
            </button>
        </div>
    </div>

    <script>
        // Sample data - D·ªØ li·ªáu gi·∫£
        const events = [
            {
                id: 1,
                name: "L·ªÖ h·ªôi √¢m nh·∫°c m√πa h√® 2024",
                description: "M·ªôt ƒë√™m nh·∫°c tuy·ªát v·ªùi v·ªõi nh·ªØng ngh·ªá sƒ© h√†ng ƒë·∫ßu Vi·ªát Nam. C√πng nhau t·∫≠n h∆∞·ªüng nh·ªØng giai ƒëi·ªáu s√¥i ƒë·ªông v√† kh√¥ng kh√≠ l·ªÖ h·ªôi s√¥i n·ªïi.",
                status: "PUBLISHED",
                start_datetime: "2024-07-15T19:00:00",
                end_datetime: "2024-07-15T23:00:00",
                address: "C√¥ng vi√™n Th·ªëng Nh·∫•t, H√† N·ªôi",
                banner_image: null,
                created_at: "2024-01-15T10:00:00",
                updated_at: "2024-01-20T14:30:00",
                published_at: "2024-01-20T14:30:00",
                ticketTypes: [
                    { name: "V√© th∆∞·ªùng", price: "500,000 VNƒê", description: "Khu v·ª±c ƒë·ª©ng" },
                    { name: "V√© VIP", price: "1,200,000 VNƒê", description: "Khu v·ª±c ng·ªìi g·∫ßn s√¢n kh·∫•u" }
                ]
            },
            {
                id: 2,
                name: "H·ªôi th·∫£o C√¥ng ngh·ªá AI 2024",
                description: "Kh√°m ph√° nh·ªØng xu h∆∞·ªõng m·ªõi nh·∫•t trong lƒ©nh v·ª±c tr√≠ tu·ªá nh√¢n t·∫°o c√πng c√°c chuy√™n gia h√†ng ƒë·∫ßu trong ng√†nh.",
                status: "PUBLISHED",
                start_datetime: "2024-06-20T09:00:00",
                end_datetime: "2024-06-20T17:00:00",
                address: "Trung t√¢m H·ªôi ngh·ªã Qu·ªëc gia, TP.HCM",
                banner_image: null,
                created_at: "2024-01-10T08:00:00",
                updated_at: "2024-01-25T16:45:00",
                published_at: "2024-01-25T16:45:00",
                ticketTypes: [
                    { name: "V√© sinh vi√™n", price: "200,000 VNƒê", description: "D√†nh cho sinh vi√™n c√≥ th·∫ª" },
                    { name: "V√© th∆∞·ªùng", price: "800,000 VNƒê", description: "Bao g·ªìm t√†i li·ªáu v√† coffee break" }
                ]
            },
            {
                id: 3,
                name: "Tri·ªÉn l√£m Ngh·ªá thu·∫≠t ƒê∆∞∆°ng ƒë·∫°i",
                description: "Tr∆∞ng b√†y nh·ªØng t√°c ph·∫©m ngh·ªá thu·∫≠t ƒë∆∞∆°ng ƒë·∫°i ƒë·ªôc ƒë√°o t·ª´ c√°c ngh·ªá sƒ© tr·∫ª t√†i nƒÉng trong v√† ngo√†i n∆∞·ªõc.",
                status: "PUBLISHED",
                start_datetime: "2024-08-01T10:00:00",
                end_datetime: "2024-08-31T18:00:00",
                address: "B·∫£o t√†ng M·ªπ thu·∫≠t, H√† N·ªôi",
                banner_image: null,
                created_at: "2024-02-01T12:00:00",
                updated_at: "2024-02-05T09:15:00",
                published_at: "2024-02-05T09:15:00",
                ticketTypes: [
                    { name: "V√© ng∆∞·ªùi l·ªõn", price: "150,000 VNƒê", description: "V√© tham quan c·∫£ th√°ng" },
                    { name: "V√© tr·∫ª em", price: "75,000 VNƒê", description: "D√†nh cho tr·∫ª em d∆∞·ªõi 12 tu·ªïi" }
                ]
            },
            {
                id: 4,
                name: "Workshop N·∫•u ƒÉn √ù",
                description: "H·ªçc c√°ch l√†m pasta v√† pizza authentic t·ª´ ƒë·∫ßu b·∫øp ng∆∞·ªùi √ù ch√≠nh hi·ªáu. M·ªôt tr·∫£i nghi·ªám ·∫©m th·ª±c kh√¥ng th·ªÉ b·ªè l·ª°.",
                status: "DRAFT",
                start_datetime: "2024-09-10T14:00:00",
                end_datetime: "2024-09-10T17:00:00",
                address: "Nh√† h√†ng Bella Italia, Qu·∫≠n 1, TP.HCM",
                banner_image: null,
                created_at: "2024-02-10T11:30:00",
                updated_at: "2024-02-10T11:30:00",
                published_at: "2024-09-01T00:00:00",
                ticketTypes: [
                    { name: "V√© tham gia", price: "1,500,000 VNƒê", description: "Bao g·ªìm nguy√™n li·ªáu v√† b·ªØa ƒÉn" }
                ]
            },
            {
                id: 5,
                name: "Ch·∫°y b·ªô Marathon H√† N·ªôi",
                description: "S·ª± ki·ªán ch·∫°y b·ªô l·ªõn nh·∫•t nƒÉm v·ªõi c√°c c·ª± ly 5km, 10km, 21km v√† 42km. C√πng nhau v√¨ s·ª©c kh·ªèe v√† m√¥i tr∆∞·ªùng xanh.",
                status: "PUBLISHED",
                start_datetime: "2024-10-15T06:00:00",
                end_datetime: "2024-10-15T12:00:00",
                address: "H·ªì G∆∞∆°m, H√† N·ªôi",
                banner_image: null,
                created_at: "2024-01-05T07:00:00",
                updated_at: "2024-02-15T10:20:00",
                published_at: "2024-02-15T10:20:00",
                ticketTypes: [
                    { name: "5km", price: "300,000 VNƒê", description: "Bao g·ªìm √°o, s·ªë bib v√† huy ch∆∞∆°ng" },
                    { name: "21km", price: "500,000 VNƒê", description: "Bao g·ªìm √°o, s·ªë bib v√† huy ch∆∞∆°ng" },
                    { name: "42km", price: "800,000 VNƒê", description: "Bao g·ªìm √°o, s·ªë bib v√† huy ch∆∞∆°ng" }
                ]
            },
            {
                id: 6,
                name: "L·ªÖ h·ªôi Bia Craft Vi·ªát Nam",
                description: "Th∆∞·ªüng th·ª©c nh·ªØng lo·∫°i bia th·ªß c√¥ng tuy·ªát h·∫£o t·ª´ c√°c nh√† s·∫£n xu·∫•t ƒë·ªãa ph∆∞∆°ng c√πng √¢m nh·∫°c v√† ·∫©m th·ª±c ƒë·∫∑c s·∫Øc.",
                status: "CANCELLED",
                start_datetime: "2024-05-25T17:00:00",
                end_datetime: "2024-05-26T22:00:00",
                address: "C√¥ng vi√™n Tao ƒê√†n, TP.HCM",
                banner_image: null,
                created_at: "2024-01-20T15:00:00",
                updated_at: "2024-03-01T12:00:00",
                published_at: "2024-01-25T15:00:00",
                ticketTypes: [
                    { name: "V√© 1 ng√†y", price: "400,000 VNƒê", description: "Bao g·ªìm 3 ly bia v√† ƒë·ªì ƒÉn nh·∫π" },
                    { name: "V√© 2 ng√†y", price: "700,000 VNƒê", description: "Bao g·ªìm 6 ly bia v√† ƒë·ªì ƒÉn" }
                ]
            }
        ];

        let filteredEvents = [...events];
        let currentEvent = null;

        // Format date function
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Get status badge
        function getStatusBadge(status) {
            const badges = {
                'PUBLISHED': '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">‚úÖ ƒê√£ xu·∫•t b·∫£n</span>',
                'DRAFT': '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">üìù B·∫£n nh√°p</span>',
                'CANCELLED': '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">‚ùå ƒê√£ h·ªßy</span>'
            };
            return badges[status] || '';
        }

        // Render events
        function renderEvents(eventsToRender = filteredEvents) {
            const grid = document.getElementById('eventsGrid');
            const noResults = document.getElementById('noResults');

            if (eventsToRender.length === 0) {
                grid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            grid.innerHTML = eventsToRender.map(event => `
                <div class="bg-white rounded-xl shadow-md card-hover cursor-pointer" onclick="openEventDetail(${event.id})">
                    <div class="h-48 bg-gradient-to-r from-purple-400 to-pink-400 rounded-t-xl flex items-center justify-center text-white text-6xl">
                        üé™
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-bold text-gray-800 line-clamp-2">${event.name}</h3>
                            ${getStatusBadge(event.status)}
                        </div>
                        <p class="text-gray-600 mb-4 line-clamp-3">${event.description}</p>
                        <div class="space-y-2 text-sm text-gray-500">
                            <div class="flex items-center">
                                <span class="mr-2">üìÖ</span>
                                <span>${formatDate(event.start_datetime)}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="mr-2">üìç</span>
                                <span class="line-clamp-1">${event.address}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="mr-2">üé´</span>
                                <span>${event.ticketTypes.length} lo·∫°i v√©</span>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <button class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors font-medium">
                                Xem chi ti·∫øt
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Search events
        function searchEvents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            filteredEvents = events.filter(event => {
                const matchesSearch = event.name.toLowerCase().includes(searchTerm) ||
                                    event.description.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || event.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            renderEvents(filteredEvents);
        }

        // Open event detail modal
        function openEventDetail(eventId) {
            currentEvent = events.find(event => event.id === eventId);
            if (!currentEvent) return;

            document.getElementById('modalTitle').textContent = currentEvent.name;
            document.getElementById('modalDescription').textContent = currentEvent.description;
            document.getElementById('modalStartTime').textContent = formatDate(currentEvent.start_datetime);
            document.getElementById('modalEndTime').textContent = formatDate(currentEvent.end_datetime);
            document.getElementById('modalAddress').textContent = currentEvent.address;

            // Render ticket types
            const ticketTypesContainer = document.getElementById('ticketTypes');
            ticketTypesContainer.innerHTML = currentEvent.ticketTypes.map(ticket => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium text-gray-800">${ticket.name}</div>
                        <div class="text-sm text-gray-600">${ticket.description}</div>
                    </div>
                    <div class="text-lg font-bold text-purple-600">${ticket.price}</div>
                </div>
            `).join('');

            document.getElementById('eventModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('eventModal').classList.remove('active');
        }

        // Buy ticket
        function buyTicket() {
            if (currentEvent.status !== 'PUBLISHED') {
                alert('S·ª± ki·ªán n√†y ch∆∞a ƒë∆∞·ª£c xu·∫•t b·∫£n ho·∫∑c ƒë√£ b·ªã h·ªßy!');
                return;
            }

            closeModal();
            document.getElementById('purchaseModal').classList.add('active');
        }

        // Close purchase modal
        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.remove('active');
        }

        // Share event
        function shareEvent() {
            if (navigator.share) {
                navigator.share({
                    title: currentEvent.name,
                    text: currentEvent.description,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    alert('ƒê√£ sao ch√©p link s·ª± ki·ªán v√†o clipboard!');
                });
            }
        }

        // Add event listeners
        document.getElementById('searchInput').addEventListener('input', searchEvents);
        document.getElementById('statusFilter').addEventListener('change', searchEvents);

        // Close modals when clicking outside
        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.getElementById('purchaseModal').addEventListener('click', function(e) {
            if (e.target === this) closePurchaseModal();
        });

        // Initialize
        renderEvents();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976ce3cf67d3ef6e',t:'MTc1NjQ3OTMzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>

{% endblock %}